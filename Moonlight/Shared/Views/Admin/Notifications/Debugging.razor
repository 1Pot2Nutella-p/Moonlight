@page "/admin/notifications/debugging"
@using Moonlight.App.Services.Notifications
@using Moonlight.App.Services.Interop

@inject NotificationServerService NotificationServerService
@inject AlertService AlertService

<OnlyAdmin>
    <LazyLoader Load="Load">
        <h1>Notification Debugging</h1>
        @foreach (var client in Clients)
        {
            <hr/>
            <div>
                <p>Id: @client.NotificationClient.Id User: @client.User.Email</p>
                <button class="btn btn-primary" @onclick="async () => await SendSampleNotification(client)">Sample Notification</button>
            </div>
        }
    </LazyLoader>
</OnlyAdmin>

    
@code {
    private List<NotificationClientService> Clients;

    private async Task Load(LazyLoader loader)
    {
        Clients = NotificationServerService.GetConnectedClients();
    }

    private async Task SendSampleNotification(NotificationClientService client)
    {
        await NotificationServerService.SendAction(client.User,@"{""action"": ""notify"",""notification"":{""id"":999,""channel"":""Sample Channel"",""content"":""This is a sample Notification"",""title"":""Sample Notification""}}");
        await AlertService.Info("Sent");
    }
}